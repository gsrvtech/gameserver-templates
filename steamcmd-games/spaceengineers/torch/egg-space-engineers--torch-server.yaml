_comment: 'DO NOT EDIT: FILE GENERATED AUTOMATICALLY BY PANEL'
meta:
  version: PLCN_v3
  update_url: null
exported_at: '2026-01-24T13:21:20+00:00'
name: 'Space Engineers - Torch Server'
author: info@goover.de
uuid: 502e2018-30ab-4cd4-8f95-fcbe58935c28
description: "Torch is the successor to SE Server Extender and gives server admins the tools they need to keep\ntheir Space Engineers servers running smoothly. It features a user interface with live management\ntools and a plugin system so you can run your server exactly how you'd like. Torch is still in early\ndevelopment so there may be bugs and incomplete features.\r\n\r\n!!!!! DO NOT CANCEL THE FIRST START, OR YOU NEED TO DELETE THE SERVER AND CREATE FROM SCRATCH !!!!"
image: null
tags:
  - goover.dev
features:
  - steam_disk_space
docker_images:
  'ghcr.io/goover/wine:staging': 'ghcr.io/goover/wine:staging'
file_denylist: {  }
startup_commands:
  Default: 'export WINEDLLOVERRIDES="mscoree=n,b;mshtml=n,b"; wine /home/container/Torch.Server.exe -noupdate -nogui -console'
config:
  files:
    Instance/SpaceEngineers-Dedicated.cfg:
      parser: xml
      find:
        MyConfigDedicated.SessionSettings.GameMode: '{{server.environment.SERVER_MODE}}'
        MyConfigDedicated.SessionSettings.MaxPlayers: '{{server.environment.MAX_PLAYERS}}'
        MyConfigDedicated.SessionSettings.AutoSaveInMinutes: '{{server.environment.SAVE_INTERVAL}}'
        MyConfigDedicated.SessionSettings.EnableSaving: '{{server.environment.SAVE_ENABLED}}'
        MyConfigDedicated.LoadWorld: 'Z:\home\container\Instance\Saves\{{server.environment.WORLD_NAME}}'
        MyConfigDedicated.ServerPort: '{{server.allocations.default.port}}'
        MyConfigDedicated.SteamPort: '{{server.environment.STEAM_PORT}}'
        MyConfigDedicated.ServerName: '{{server.environment.SERVER_NAME}}'
        MyConfigDedicated.WorldName: '{{server.environment.WORLD_NAME}}'
        MyConfigDedicated.ServerDescription: '{{server.environment.SERVER_DESC}}'
        MyConfigDedicated.RemoteApiEnabled: '{{server.environment.REMOTEAPI_ENABLE}}'
        MyConfigDedicated.RemoteApiPort: '{{server.environment.REMOTEAPI_PORT}}'
    config/Saves/World/Sandbox.sbc:
      parser: xml
      find:
        MyConfigDedicated.SessionSettings.GameMode: '{{server.environment.SERVER_MODE}}'
        MyConfigDedicated.SessionSettings.MaxPlayers: '{{server.environment.MAX_PLAYERS}}'
        MyConfigDedicated.SessionSettings.AutoSaveInMinutes: '{{server.environment.SAVE_INTERVAL}}'
        MyConfigDedicated.SessionSettings.EnableSaving: '{{server.environment.SAVE_ENABLED}}'
  startup:
    done: 'Game ready...'
  logs: {  }
  stop: ^C
scripts:
  installation:
    script: |
      #!/bin/bash
      # ------------------------------------------------
      # Generic Installscript Template for Pelican Eggs (Linux)
      # License: AGPLv3
      # Author: gOOvER (https://discord.goover.dev)
      # Donate: https://donate.goover.dev
      # ------------------------------------------------

      # ----------------------------
      # Environment Setup
      # ----------------------------
      HOME=/mnt/server
      export HOME

      # Ensure /mnt is owned by root
      chown -R root:root /mnt

      GAME_NAME="SpaceEngineers - Torch"   # <--- name of the game (internal placeholder)
      CONFIG_FILE_NAME="SpaceEngineers-Dedicated.cfg"      # <--- configurable config filename (internal)
      CONFIG_DIR="$HOME/Instance" # <--- adjustable per game
      CONFIG_URL="https://raw.githubusercontent.com/gsrvtech/gameserver-templates/refs/heads/main/steamcmd-games/spaceengineers/vanilla/config/SpaceEngineers-Dedicated.cfg"                  # <--- adjustable per game
      WORLD_DLURL="https://raw.githubusercontent.com/gsrvtech/gameserver-templates/main/steamcmd-games/spaceengineers/vanilla/config/world.7z"
      STEAMCMD_DIR="$HOME/steamcmd"              # <--- SteamCMD directory

      STEAM_USER="${STEAM_USER:-anonymous}"
      STEAM_PASS="${STEAM_PASS:-}"
      STEAM_AUTH="${STEAM_AUTH:-}"
      DEPOTDOWNLOADER="${DEPOTDOWNLOADER:-0}"
      : "${STEAM_APPID:?Environment variable STEAM_APPID must be set for $GAME_NAME}"  # mandatory

      # ----------------------------
      # Locale Setup to suppress warnings
      # ----------------------------
      export LANG=en_US.UTF-8
      export LANGUAGE=en_US:en
      export LC_ALL=en_US.UTF-8

      # ----------------------------
      # Logging Setup
      # ----------------------------
      SAFE_NAME="${GAME_NAME// /_}_install.log"
      INSTALL_LOG="$HOME/$SAFE_NAME"

      # Redirect all output to log while still mirroring to console
      if command -v tee >/dev/null 2>&1; then
          exec 3>&1
          exec > >(tee -a "$INSTALL_LOG" >&3) 2> >(tee -a "$INSTALL_LOG" >&2)
      else
          exec > "$INSTALL_LOG" 2>&1
      fi

      # ----------------------------
      # Colors
      # ----------------------------
      RED=$(tput setaf 1)
      GREEN=$(tput setaf 2)
      YELLOW=$(tput setaf 3)
      BLUE=$(tput setaf 4)
      CYAN=$(tput setaf 6)
      NC=$(tput sgr0)

      LINE="${BLUE}-------------------------------------------------${NC}"

      # ----------------------------
      # Logging Functions
      # ----------------------------
      log_info()    { echo "${BLUE}[INFO]${NC} $*"; }
      log_warn()    { echo "${YELLOW}[WARN]${NC} $*"; }
      log_error()   { echo "${RED}[ERROR]${NC} $*" >&2; }
      log_success() { echo "${GREEN}[ OK ]${NC} $*"; }

      # ----------------------------
      # Safe command execution
      # ----------------------------
      run_or_fail() {
          local desc="$1"; shift
          if "$@"; then
              log_success "$desc"
          else
              log_error "$desc failed!"
              exit 1
          fi
      }

      # ----------------------------
      # Start Script Output
      # ----------------------------
      clear
      log_info "$LINE"
      log_info "${YELLOW}$GAME_NAME Installscript${NC}"
      log_info "$LINE"

      if [ "$STEAM_USER" = "anonymous" ]; then
          log_warn "Using anonymous Steam login for $GAME_NAME."
      else
          log_info "Using Steam user: $STEAM_USER for $GAME_NAME."
      fi

      # ----------------------------
      # Game Installation via DepotDownloader
      # ----------------------------
      if [ "$DEPOTDOWNLOADER" = "1" ]; then
          log_info "Installing $GAME_NAME via DepotDownloader (Linux)..."
          mkdir -p "$HOME/depotdownloader"
          cd "$HOME/depotdownloader"

          if [ ! -f DepotDownloader ]; then
              log_info "Fetching DepotDownloader Linux binary..."
              run_or_fail "Download DepotDownloader" curl -sSL -o DepotDownloader https://github.com/SteamRE/DepotDownloader/releases/latest/download/DepotDownloader-Linux-x64
              run_or_fail "Make DepotDownloader executable" chmod +x DepotDownloader
          fi

          log_info "Running DepotDownloader..."
          ./DepotDownloader \
              -app $STEAM_APPID \
              -dir $HOME \
              $( [[ -n "${STEAM_BETAID:-}" ]] && printf %s "-beta $STEAM_BETAID" ) \
              $( [[ -n "${STEAM_BETAPASS:-}" ]] && printf %s "-betapassword $STEAM_BETAPASS" ) \
              ${INSTALL_FLAGS:-} \
              -username $STEAM_USER \
              -password $STEAM_PASS \
              ${STEAM_AUTH:+-remember-password $STEAM_AUTH} || \
              log_warn "DepotDownloader returned non-zero exit code, but installation may still be OK."
          log_success "DepotDownloader installation finished."
      fi

      # ----------------------------
      # Game Installation via SteamCMD
      # ----------------------------
      if [ "$DEPOTDOWNLOADER" != "1" ]; then
          log_info "Installing $GAME_NAME via SteamCMD..."
          mkdir -p "$STEAMCMD_DIR" "$HOME/steamapps"

          run_or_fail "Download SteamCMD" curl -sSL -o /tmp/steamcmd.tar.gz https://steamcdn-a.akamaihd.net/client/installer/steamcmd_linux.tar.gz
          run_or_fail "Extract SteamCMD" tar -xzvf /tmp/steamcmd.tar.gz -C "$STEAMCMD_DIR"

          cd "$STEAMCMD_DIR"

          log_info "Running SteamCMD..."
          ./steamcmd.sh +force_install_dir $HOME \
              +login $STEAM_USER $STEAM_PASS $STEAM_AUTH \
              $( [[ "${WINDOWS_INSTALL:-0}" == "1" ]] && printf %s '+@sSteamCmdForcePlatformType windows' ) \
              $( [[ "${STEAM_SDK:-0}" == "1" ]] && printf %s '+app_update 1007' ) \
              +app_update $STEAM_APPID \
              $( [[ -n "${STEAM_BETAID:-}" ]] && printf %s "-beta $STEAM_BETAID" ) \
              $( [[ -n "${STEAM_BETAPASS:-}" ]] && printf %s "-betapassword $STEAM_BETAPASS" ) \
              ${INSTALL_FLAGS:-} validate +quit || \
              log_warn "SteamCMD returned a non-zero exit code, but installation may still be OK."
          log_success "SteamCMD installation finished."
      fi

      # ----------------------------
      # Steam Libraries Setup
      # ----------------------------
      log_info "Setting up Steam libraries..."
      mkdir -p "$HOME/.steam/sdk32" "$HOME/.steam/sdk64"
      cp -v "$STEAMCMD_DIR/linux32/steamclient.so" "$HOME/.steam/sdk32/steamclient.so" || true
      cp -v "$STEAMCMD_DIR/linux64/steamclient.so" "$HOME/.steam/sdk64/steamclient.so" || true
      log_success "Steam libraries setup complete."

      # ----------------------------
      # Game-specific Hooks
      # ----------------------------
      log_info "Executing $GAME_NAME game-specific hooks..."
      ## Download Torch and unpack
      cd $HOME
      curl -sSL -o torch-server.zip https://build.torchapi.com/job/Torch/job/master/lastSuccessfulBuild/artifact/bin/torch-server.zip
      unzip -o torch-server.zip -d /mnt/server/
      rm -fR $HOME/torch-server.zip

      ## Create world and Instance
      mkdir -p $HOME/Instance/Saves
      if [ ! -d $HOME/Instance/Saves/$WORLD_NAME ]
      then
          mkdir -p $HOME/Instance/Saves/$WORLD_NAME
          OUTPUT="world.7z"
          curl -fSL "$WORLD_DLURL" -o "$OUTPUT"
          if [[ ! -s "$OUTPUT" ]]; then
              log_warn "Error: Download failed or file is empty."
              exit 1
          fi
          if file "$OUTPUT" | grep -q "7-zip archive"; then
              log_success "File appears to be a valid 7z archive."
          else
              log_warn "Warning: File does not look like a valid 7z archive."
          fi
          7zz x world.7z -aoa -mmt=off -o/$HOME/Instance/Saves/$WORLD_NAME
      fi

      # ----------------------------
      # Config Setup
      # ----------------------------
      if [ -f "$CONFIG_DIR/$CONFIG_FILE_NAME" ]; then
          log_success "$GAME_NAME $CONFIG_FILE_NAME found."
      else
          log_warn "$GAME_NAME $CONFIG_FILE_NAME not found. Fetching default..."
          mkdir -p "$CONFIG_DIR"
          run_or_fail "Download default $CONFIG_FILE_NAME" curl -sSL -o "$CONFIG_DIR/$CONFIG_FILE_NAME" "$CONFIG_URL"
      fi

      # ----------------------------
      # Done
      # ----------------------------
      log_info "$LINE"
      log_success "$GAME_NAME installation completed successfully."
      log_info "$LINE"
    container: 'ghcr.io/goover/installers:debian'
    entrypoint: bash
variables:
  -
    sort: 6
    name: 'Maximum Players'
    description: ''
    env_variable: MAX_PLAYERS
    default_value: 4
    user_viewable: true
    user_editable: true
    rules:
      - required
      - numeric
      - 'digits_between:1,3'
  -
    sort: 10
    name: 'Enable Remote API'
    description: 'Enable Remote API'
    env_variable: REMOTEAPI_ENABLE
    default_value: false
    user_viewable: true
    user_editable: true
    rules:
      - required
      - string
      - 'in:true,false'
  -
    sort: 11
    name: 'Remote API Port'
    description: 'Remote API Port'
    env_variable: REMOTEAPI_PORT
    default_value: ''
    user_viewable: true
    user_editable: true
    rules:
      - required
      - numeric
      - 'max:65535'
  -
    sort: 7
    name: 'Enable Saving'
    description: ''
    env_variable: SAVE_ENABLED
    default_value: true
    user_viewable: true
    user_editable: true
    rules:
      - required
      - string
      - 'in:true,false'
  -
    sort: 8
    name: 'Auto Save Interval'
    description: 'Time between auto saves specified in minutes'
    env_variable: SAVE_INTERVAL
    default_value: 5
    user_viewable: true
    user_editable: true
    rules:
      - required
      - numeric
      - 'digits_between:1,3'
  -
    sort: 4
    name: 'Server Description'
    description: 'Description of the game'
    env_variable: SERVER_DESC
    default_value: 'A Pterodactyl hosted Space Engineer Server'
    user_viewable: true
    user_editable: true
    rules:
      - required
      - string
      - 'max:200'
  -
    sort: 5
    name: 'Game Mode'
    description: 'Game Mode setting: Survival, Creative'
    env_variable: SERVER_MODE
    default_value: Survival
    user_viewable: true
    user_editable: true
    rules:
      - required
      - string
      - 'in:Survival,Creative'
  -
    sort: 2
    name: '[SERVER] Server Name'
    description: 'Name of the server, appears in Steam browser.'
    env_variable: SERVER_NAME
    default_value: 'Torch Space Engineer Server - discord.goover.dev'
    user_viewable: true
    user_editable: true
    rules:
      - required
      - string
      - 'max:64'
  -
    sort: 1
    name: '[STEAM] Steam APPID'
    description: 'The ID corresponding to the game to download.'
    env_variable: STEAM_APPID
    default_value: 298740
    user_viewable: false
    user_editable: false
    rules:
      - required
      - numeric
  -
    sort: 9
    name: 'Steam Port'
    description: 'Steam Port'
    env_variable: STEAM_PORT
    default_value: ''
    user_viewable: true
    user_editable: true
    rules:
      - required
      - numeric
  -
    sort: 13
    name: WINDOWS_INSTALL
    description: ''
    env_variable: WINDOWS_INSTALL
    default_value: 1
    user_viewable: false
    user_editable: false
    rules:
      - required
      - boolean
  -
    sort: 14
    name: WINEDEBUG
    description: ''
    env_variable: WINEDEBUG
    default_value: '-all'
    user_viewable: false
    user_editable: false
    rules:
      - required
      - string
      - 'max:20'
  -
    sort: 12
    name: WINETRICKS_RUN
    description: ''
    env_variable: WINETRICKS_RUN
    default_value: 'vcrun2013 vcrun2017 corefonts dotnet48'
    user_viewable: false
    user_editable: false
    rules:
      - required
      - string
  -
    sort: 3
    name: 'World Name'
    description: 'Name of your world (and of your save folder) DO NOT CHANGE THIS !!!!'
    env_variable: WORLD_NAME
    default_value: World
    user_viewable: true
    user_editable: false
    rules:
      - required
      - string
      - 'max:20'
  -
    sort: 15
    name: XVFB
    description: ''
    env_variable: XVFB
    default_value: 1
    user_viewable: false
    user_editable: false
    rules:
      - required
      - boolean
